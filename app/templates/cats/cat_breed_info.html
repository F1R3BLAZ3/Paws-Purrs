{% extends 'base.html' %}

{% block title %}Cat Image Details{% endblock %}

{% block styles %}
<!-- Your styles here -->
{% endblock %}

{% block content %}
<div class="navigation">
    {% if prev_breed_id %}
    <a href="{{ url_for('get_cat_breed_info', breed_id=prev_breed_id) }}">
        <img src="{{ url_for('static', filename='images/back.png') }}" alt="Previous Breed">
    </a>
    {% endif %}
    {% if next_breed_id %}
    <a href="{{ url_for('get_cat_breed_info', breed_id=next_breed_id) }}">
        <img src="{{ url_for('static', filename='images/next.png') }}" alt="Next Breed">
    </a>
    {% endif %}
</div>

<div style="margin-top: 100px; margin-left: 20px; margin-right: 20px;">
    <h1 style="font-size: 60px; margin-bottom: 0;">{{ breed_info.name }}</h1>
    <h2 style="font-size: 32px; color: gray;">{{ breed_info.origin }}</h2> 
</div>

<div class="cat_details-container">
    {% if images_info %}
    <img style="cursor: pointer;" src="{{ images_info[0].url }}" alt="{{ breed_info.name }}"
        onclick="openModal('{{ images_info[0].url }}')">
    {% else %}
    <img src="{{ url_for('static', filename='images/cat404.png') }}" alt="No Cat Image">
    {% endif %}

    <div style="width: 40%;">
        <table>
            <tr>
                <th>Traits of the {{ breed_info.name }}</th>
                <th>Rating</th>
            </tr>
            {% for trait in ['adaptability', 'affection_level', 'child_friendly', 'dog_friendly', 'energy_level', 'grooming', 'health_issues', 'intelligence', 'shedding_level', 'social_needs', 'stranger_friendly'] %}
                <tr>
                    <td>{{ trait.replace('_', ' ').capitalize() }}</td>
                    <td>
                        {% for i in range(1, 6) %}
                            {% if i <= breed_info[trait] %}
                                <span class="circle filled"></span>
                            {% else %}
                                <span class="circle"></span>
                            {% endif %}
                        {% endfor %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>

<hr style="border-top: 1px solid gray; margin: auto; width: 50%">

<div class="cat_details-container">
    <ul style="width: 50%;">  
        <li style="line-height: 24px;">{{breed_info.description}}</li>
        <li style="color: gray;"><strong>Life span:</strong> {{ breed_info.life_span }} years</li>
        <li style="color: gray;"><strong>Weight: </strong>{{ breed_info.weight.imperial }} lb / {{ breed_info.weight.metric }} kg</li>
        <li>
            {% if 'temperament' in breed_info %}
                {% set temperament_list = breed_info.temperament.split(",") %}
                {% for temperament in temperament_list[:5] %}
                    <div class="tag">{{ temperament }}</div>
                {% endfor %}
            {% else %}
                N/A 
            {% endif %}
        </li> 
    </ul>
    <div style="width: 40%;">
        <table>
            <tr>
                <th>How the {{ breed_info.name }} is like</th>
                <th>Value</th>
            </tr>
            {% for trait in ['lap', 'grooming', 'experimental', 'indoor', 'vocalisation', 'experimental', 'hairless', 'natural', 'rare', 'rex', 'suppressed_tail', 'short_legs', 'hypoallergenic'] %}
                <tr>
                    <td>{{ trait.replace('_', ' ').capitalize() }}</td>
                    <td>
                        {% if breed_info[trait] == 1 %}
                            Yes
                        {% else %}
                            No
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>
<div class="image-grid">
    {% for image in images_info[1:] %}
    <div class="img-container" onclick="openModal('{{ image.url }}')">
        <img src="{{ image.url }}" alt="{{ breed_info.name }}"
            style="height: 244px; object-fit: cover; cursor: pointer">
    </div>
    {% endfor %}
</div>

<div id="myModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <div class="navigation-buttons">
        <button onclick="changeImage(-1)">❮</button>
        <button onclick="changeImage(1)">❯</button>
    </div>
    <img class="modal-content" id="img01">
</div>

<script>
    var currentImageIndex = 0;
    var imagesInfo = {{ images_info| tojson | safe }};

    function openModal(index) {
        var modal = document.getElementById("myModal");
        var modalImg = document.getElementById("img01");

        modal.style.display = "block";
        currentImageIndex = index >= 0 && index < imagesInfo.length ? index : 0;
        modalImg.src = imagesInfo[currentImageIndex].url;
    }

    function closeModal() {
        document.getElementById("myModal").style.display = "none";
    }

    function changeImage(offset) {
        currentImageIndex += offset;
        if (currentImageIndex < 0) {
            currentImageIndex = imagesInfo.length - 1;
        } else if (currentImageIndex >= imagesInfo.length) {
            currentImageIndex = 0;
        }
        document.getElementById("img01").src = imagesInfo[currentImageIndex].url;
    }

    function nextImage() {
        changeImage(1);
    }

    var prevBreedId = "{{ prev_breed_id }}";
    var nextBreedId = "{{ next_breed_id }}";

    var prevImage = document.querySelector('.navigation a:first-child img');
    var nextImage = document.querySelector('.navigation a:last-child img');

    prevImage.addEventListener('click', function () {
        if (prevBreedId) {
            window.location.href = "{{ url_for('get_cat_breed_info', breed_id=prevBreedId) }}";
        }
    });

    nextImage.addEventListener('click', function () {
        if (nextBreedId) {
            window.location.href = "{{ url_for('get_cat_breed_info', breed_id=nextBreedId) }}";
        }
    });
</script>

{% endblock %}
